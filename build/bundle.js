!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));const s={AFTERBEGIN:"afterbegin",AFTEREND:"afterend",BEFOREEND:"beforeend"},i=(e,t,n)=>{switch(n){case s.AFTERBEGIN:e.prepend(t);break;case s.BEFOREEND:e.append(t)}};class a{constructor(){this._element=null,this._createTemplate=null,this._callback=null}getTemplate(){return this._createTemplate}getElement(){return this._element||(this._element=(e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild})(this.getTemplate())),this._element}}class l extends a{constructor(e,t){super(),this._element=null,this._allQuantity=e,this._callback={},this._clickHandler=this._clickHandler.bind(this),this._createTemplate=((e,t)=>`<button class="news__button">\n  <span>Новости</span>\n  <span>${e} / ${t} непрочитано</span>\n  <span></span>\n</button>`)(e,t)}setClickHandler(e){this._callback.click=e,this.getElement().addEventListener("click",this._clickHandler)}changeReaded(e){this._qunatity=this.getElement().querySelector("span:not(:first-child)"),this._qunatity.textContent=`${this._allQuantity} / ${e} непрочитано`}_clickHandler(e){e.preventDefault(),this._callback.click(),this.getElement().classList.contains("news__button--opened")?this.getElement().classList.remove("news__button--opened"):this.getElement().classList.add("news__button--opened")}}class r extends a{constructor(){super(),this._element=null,this._createTemplate='<section class="news__container"></section>'}}class o extends a{constructor(){super(),this._createTemplate='<section class="news__feed">\n\n  </section>'}toggleNewsFeed(){this.getElement().classList.contains("visually-hidden")?this.getElement().classList.remove("visually-hidden"):this.getElement().classList.add("visually-hidden")}}const c=e=>e.filter(e=>!1===e.isRead).length,h=(e,t,n,s,i)=>{return`<article class="news__item">\n      <h3>${e}</h3>\n      <div class="news__details">\n        <b>${t}</b>\n        <time datetime="2001-05-15 19:00">${a=n,new Date(a).toLocaleString("ru",{day:"numeric",year:"numeric",month:"long",hour:"2-digit",minute:"2-digit"})}</time>\n        <span>${i?"Прочитано":"Не прочитано"}</span>\n        <button>Читать далее</button>\n        <div class="news__text visually-hidden">\n          ${(e=>e.reduce((e,t)=>e+=`<p>${t}</p>`,""))(s)}\n        </div>\n      </div>\n    </article>`;var a};class d extends a{constructor(e){super(),this._heading=e.heading,this._name=e.name,this._time=e.date,this._isRead=e.isRead,this._text=e.text,this._callback={},this._newsTextContainer=this.getElement().querySelector(".news__text"),this._buttonExpand=this.getElement().querySelector("button"),this._readStatus=this.getElement().querySelector("span"),this._buttonClickHandler=this._buttonClickHandler.bind(this)}getTemplate(){return h(this._heading,this._name,this._time,this._text,this._isRead)}setClickHandler(e){this._callback.click=e,this._buttonExpand.addEventListener("click",this._buttonClickHandler)}_buttonClickHandler(){this._newsTextContainer.classList.contains("visually-hidden")?(this._newsTextContainer.classList.remove("visually-hidden"),this._buttonExpand.textContent="Свернуть",this._isRead||(this._isRead=!0,this._readStatus.textContent="Прочитано",this._callback.click())):(this._newsTextContainer.classList.add("visually-hidden"),this._buttonExpand.textContent="Читать далее")}}class _{constructor(e,t){this._newsItems=t,this._isRendered=!1,this._allQuantity=t.length,this._notReadQuantity=c(t),this._newsBlock=e,this._newsContainerComponent=new r,this._buttonComponent=new l(t.length,c(t)),this._newsFeedComponent=new o,this._handleNewsButtonClick=this._handleNewsButtonClick.bind(this),this._handleReadNewsClick=this._handleReadNewsClick.bind(this)}_renderContainer(){i(this._newsBlock,this._newsContainerComponent.getElement(),s.AFTERBEGIN)}_renderButton(){i(this._newsContainerComponent.getElement(),this._buttonComponent.getElement(),s.AFTERBEGIN),this._buttonComponent.setClickHandler(this._handleNewsButtonClick)}_renderNews(){this._newsItems.forEach(e=>{const t=new d(e);t.setClickHandler(this._handleReadNewsClick),i(this._newsFeedComponent.getElement(),t.getElement(),s.BEFOREEND)}),i(this._newsContainerComponent.getElement(),this._newsFeedComponent.getElement(),s.BEFOREEND)}init(){this._renderContainer(),this._renderButton()}_handleNewsButtonClick(){this._isRendered?this._newsFeedComponent.toggleNewsFeed():(this._renderNews(),this._isRendered=!0)}_handleReadNewsClick(){this._notReadQuantity--,this._buttonComponent.changeReaded(this._notReadQuantity)}}const u=[{id:0,heading:"В деревне Бабкино небывалый урожай капусты",name:"Валерий Петриченко",isRead:!1,date:"2020-12-04T17:13:50.157Z",text:["Небывалым скандалом окончилась футбольная игра между футбольными клубами “Факел” и “Пламя”. На 85 минуте в ворота гостей был назначен пенальти.","Полузащитник гостей приготовился ударить по мячу, но озорной пес Тузик схватил его за бутсу, снял с ноги и был таков."]},{id:1,heading:"Спортивная битва переросла в массовую драку",name:"Алина Ткачева",isRead:!1,date:"2020-12-04T17:13:50.157Z",text:["Небывалым скандалом окончилась футбольная игра между футбольными клубами “Факел” и “Пламя”. На 85 минуте в ворота гостей был назначен пенальти.","Полузащитник гостей приготовился ударить по мячу, но озорной пес Тузик схватил его за бутсу, снял с ноги и был таков."]},{id:2,heading:"Спортивная битва переросла в массовую драку",name:"Алина Ткачева",isRead:!1,date:"2020-04-12T14:48:00.000Z",text:["Небывалым скандалом окончилась футбольная игра между футбольными клубами “Факел” и “Пламя”. На 85 минуте в ворота гостей был назначен пенальти.","Полузащитник гостей приготовился ударить по мячу, но озорной пес Тузик схватил его за бутсу, снял с ноги и был таков."]}];class m{constructor(e){const{container:t,type:n,source:s}=e;this._newsBlock=document.querySelector("#"+t),this._type=n,this._source=s}startFromServer(){fetch(this._source).then(e=>{if(200!==e.status)throw new Error("Ошибка загрузки данных с сервера: "+e.status);e.json().then(e=>{new _(this._newsBlock,e).init()})}).catch(e=>{throw new Error("Произошла неизвестная ошибка, код ошибки:"+e)})}startWithMocks(){new _(this._newsBlock,u).init()}init(){if(!this._newsBlock)throw new Error("Выбран несуществующий контейнер");if("server"===this._type)this.startFromServer();else{if("mocks"!==this._type)throw new Error("Некорректно указан тип работы");this.startWithMocks()}}}window.NewsWidget=m}]);